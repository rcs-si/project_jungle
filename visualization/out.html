<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zoomable Treemap</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: sans-serif;
        }
        .node {
            cursor: pointer;
        }
        .node rect {
            stroke: #fff;
        }
        .label {
            font-size: 12px;
            fill: white;
            text-anchor: middle;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <svg width="960" height="600"></svg>
    <script>
        async function fetchData() {
            const response = await fetch('processed_data.json'); // Replace with path as needed
            const data = await response.json();
            return data;
        }

        fetchData().then(data => {
            const width = 960, height = 600;
            const svg = d3.select("svg")
                .attr("viewBox", [0, 0, width, height])
                .style("font", "12px sans-serif");

            const format = d3.format(",d");
            const color = d3.scaleOrdinal(d3.schemeCategory10);

            const treemap = d3.treemap()
                .size([width, height])
                .padding(1)
                .round(true);

            const root = d3.hierarchy(data, d => d.children)
                .sum(d => d.size_in_gb || 0)
                .sort((a, b) => b.value - a.value);


            treemap(root);

            let currentRoot = root;
            const group = svg.append("g").call(render, root);

            function render(group, root) {
                const node = group.selectAll("g")
                    .data(root.children)
                    .join("g")
                    .attr("class", "node")
                    .attr("transform", d => `translate(${d.x0},${d.y0})`)
                    .on("click", (event, d) => zoom(d));

                node.append("rect")
                    .attr("fill", d => color(d.data.name))
                    .attr("width", d => d.x1 - d.x0)
                    .attr("height", d => d.y1 - d.y0);

                node.append("text")
                    .attr("x", d => (d.x1 - d.x0) / 2)
                    .attr("y", d => (d.y1 - d.y0) / 2)
                    .attr("dy", "0.35em")
                    .attr("class", "label")
                    .text(d => d.data.name);
            }

            function zoom(d) {
                if (!d.children) return;
                currentRoot = d;

                treemap(d);

                svg.transition()
                    .duration(750)
                    .call(t => group.transition(t).remove()
                        .call(render, d));
            }
        });
    </script>
</body>
</html>
